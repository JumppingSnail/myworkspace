<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>详情</title>

    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">

    <style type="text/css">
        /*您可以将下列样式写入自己的样式表中*/
        .childBody {
            padding: 15px;
        }

        /*layui 元素样式改写*/
        .layui-btn-sm {
            line-height: normal;
            font-size: 12.5px;
        }

        .layui-table-view .layui-table-body {
            min-height: 256px;
        }

        .layui-table-cell .layui-input.layui-unselect {
            height: 30px;
            line-height: 30px;
        }

        /*设置 layui 表格中单元格内容溢出可见样式*/
        .table-overlay .layui-table-view,
        .table-overlay .layui-table-box,
        .table-overlay .layui-table-body {
            overflow: visible;
        }

        .table-overlay .layui-table-cell {
            height: auto;
            overflow: visible;
        }

        /*!*文本对齐方式*!*/
        /*.text-center {*/
        /*    text-align: center;*/
        /*}*/


    </style>

</head>
<body class="childBody">
<section class="layui-col-md10" style="margin: 0 auto; float: none;">
    <div class="layui-form layui-edit-form" id="edit-div">
        <input type="hidden" id="id" name="id"/>
        <div class="layui-row">
            <div class="layui-col-sm4">
                <label class="layui-form-label">医案出处</label>
                <div class="layui-input-block">
                    <input type="hidden" id="reposId" name="reposId"/>
                    <input type="text" class="layui-input" id="reposName" name="reposName" lay-reqtext="医案出处不能为空"
                           lay-verify="required" readonly="readonly" value="" data-method="openWin" placeholder="点击选择医案出处"/>
<!--                    <i class="layui-icon layui-select-search-icon">&#xe615;</i>-->
                </div>
            </div>

            <div class="layui-col-sm4">
                <label class="layui-form-label">出处章节</label>
                <div class="layui-input-block">
                    <input type="hidden" id="sectionId" name="sectionId"/>
                    <input type="text" class="layui-input" id="sectionName" name="sectionName"
                           lay-reqtext="出处章节不能为空" lay-verify="required"
                           readonly="readonly" value="" data-method="openReport" placeholder="点击选择出处章节"/>
<!--                    <i class="layui-icon layui-select-search-icon">&#xe615;</i>-->
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-col-sm4">
                <label class="layui-form-label">患者名称</label>
                <div class="layui-input-block">
                    <input type="text" name="patientName" readonly="readonly" id="patientName" class="layui-input" value="" maxlength="50"
                           placeholder="-"/>
                </div>
            </div>

            <div class="layui-col-sm4">
                <label class="layui-form-label">患者年龄</label>
                <div class="layui-input-block">
                    <input type="text" name="patientAge" id="patientAge" class="layui-input" value="" maxlength="50"
                           lay-reqtext="年龄不能为空" readonly="readonly" placeholder="请输入年龄" lay-verify="required"/>
                </div>
            </div>

            <div class="layui-col-sm4">
                <label class="layui-form-label">患者性别</label>
                <div class="layui-form layui-input-block">
                    <select name="patientSex" id="patientSex" disabled="disabled" class="layui-input">
                        <option value="2">未知</option>
                        <option value="0">男</option>
                        <option value="1">女</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">中医诊断</label>
            <div class="layui-input-block">
                <input type="hidden" id="cnDiseaseIds" name="cnDiseaseIds"/>
                <input type="text" class="layui-input" id="cnDiseaseMap" name="cnDiseaseMap"
                       readonly="readonly" value="" data-method="diseaseMapMethod" placeholder="点击选择中医诊断"
                       lay-reqtext="中医诊断不能为空" lay-verify="required"/>
<!--                <i class="layui-icon layui-select-search-icon">&#xe615;</i>-->
            </div>
        </div>

        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">病因主诉</label>
            <div class="layui-input-block">
                <textarea name="caseDescription" id="caseDescription" class="layui-textarea" placeholder="病因主诉"
                          lay-reqtext="病因主诉" readonly="readonly"  lay-verify="required" maxlength="300"></textarea>
            </div>
        </div>

    </div>

    <!-- 列表区域 -->
    <div style="margin: 0 20px;">
        <div class="layui-card-header">处方记录</div>
        <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>

        <script type="text/html" id="num_down">
            {{d.LAY_TABLE_INDEX+1}}
        </script>

        <script type="text/html" id="currentTableBar">
            <a class="layui-btn layui-btn-normal layui-btn-xs data-count-save" lay-event="edit">修改</a>
        </script>

    </div>

<!--    <div class="layui-card">-->
<!--        <div class="layui-card-header">处方记录</div>-->
<!--        <div class="layui-card-body layui-text" style="height: auto;">-->
<!--            &lt;!&ndash; 列表 &ndash;&gt;-->
<!--            <div id="tableRes" class="table-overlay">-->

<!--                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>-->

<!--                <script type="text/html" id="num_down">-->
<!--                    {{d.LAY_TABLE_INDEX+1}}-->
<!--                </script>-->

<!--                <script type="text/html" id="currentTableBar">-->
<!--                    <a class="layui-btn layui-btn-normal layui-btn-xs data-count-save" lay-event="edit">修改</a>-->
<!--                </script>-->
<!--            </div>-->

<!--        </div>-->
<!--    </div>-->

</section>
<!--recommended script position-->
<script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="../../js/app.js" charset="utf-8"></script>
<script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    let oldDataResult = [];
    //layui 模块化引用
    layui.use(['jquery', 'table', 'layer'], function () {
        var $ = layui.$, table = layui.table, form = layui.form, layer = layui.layer;

        let dataObj = global_getLocalStorage("case-list-details#obj") || {};
        global_removeLocalStorage("case-list-details#obj")

        if (dataObj){
            $("#patientName").val(dataObj.patient_name)
            $("#id").val(dataObj.id)
            $("#patientAge").val(dataObj.patient_age)
            $("#patientSex").find("option[value=" + dataObj.patient_sex + "]").prop("selected", true);
            $("#reposId").val(dataObj.repos_id)
            $("#reposName").val(dataObj.repos_title)
            $("#sectionId").val(dataObj.section_id)
            $("#sectionName").val(dataObj.section_name)
            $("#caseDescription").val(dataObj.case_description)
            $("#cnDiseaseMap").val(dataObj.cn_disease)
            form.render();
        }


        var tableObj = table.render({
            elem: '#currentTableId',
            url: getRealUrl('/bizCaseTreatment/queryTreatmentList.do'),
            toolbar: '#toolbarDemo',
            method: 'get',
            where:{
                id: dataObj.id,
                caseDiseaseId: dataObj.cd_id
            },
            defaultToolbar: [],
            even: true,
            cols: [[
                {field: 'num', title: '序号', width: 60, align: 'center', templet: '#num_down', fixed: 'left'},
                {field: 'change_content', width: 100, title: '治疗类型'},
                {field: 'treat_name', width: 100, title: '方剂名称'},
                {field: 'treat_usage', width: 100,  title: '用量'},
                {field: 'drug_info', title: '方剂明细'},
                {field: 'treat_result', title: '治疗效果'},
                {title: '操作', width: 100, toolbar: '#currentTableBar', align: "center", fixed: 'right'}

            ]],
            limits: [20, 50, 100],
            limit: 20,
            page: false,
            height: 'full-107'
        });

        table.on('tool(currentTableFilter)', function (obj) {
            // var editObj = dataObj;
            var data = obj.data;
            // console.log(data)
            if (obj.event === 'edit') {
                global_setLocalStorage("case-list-addPreRecord#obj", data)
                var index = layer.open({
                    title: '修改处方',
                    type: 2,
                    shade: 0.2,
                    area: ['95%', '95%'],
                    content: 'case-pre-record.html'
                });
            }
        });


    });
</script>

</body>
</html>